import{a as h,b as pe,s as Ke,q as Me,r as He,p as Je,R as Xe,K as Qe,S as We,n as ce,T as Ye,v as Ze,w as et,G as me}from"./element-plus@2.9.10_vue@3.5.14-e58ff881.js";import{s as y,_ as fe}from"./index-6f2da097.js";import"./big.js@6.2.1-49ab783c.js";import{$ as r}from"./_t-d5227884.js";import{q as ge,D as be,b as Z,y as a,a as N}from"./@vue_reactivity@3.5.14-2213b677.js";import{$ as _e,o as u,H as I,I as i,a as n,i as s,M as f,c as g,F as D,X as A,L as F,n as he,k as tt}from"./@vue_runtime-core@3.5.14-81aa8ddd.js";import{U as m,s as de}from"./@vue_shared@3.5.14-94c2c668.js";function lt(p){return y({url:"/mall4cloud_biz/oss/info",method:"get",params:{fileNum:p}})}function ot(){return y({url:"/mall4cloud_biz/m/attach_file_group/list",method:"get"})}function at(p){return y({url:"/mall4cloud_biz/m/attach_file_group",method:"post",data:p})}function it(p){return y({url:"/mall4cloud_biz/m/attach_file_group",method:"put",data:p})}function st(p){return y({url:"/mall4cloud_biz/m/attach_file_group",method:"delete",params:p})}function nt(p,k){return y({headers:{"Content-Type":k.type},url:p,method:"put",data:k})}function rt(p,k){return y({headers:{"Content-Type":k.type},url:p,method:"post",data:k})}function ut(p){return y({url:"/mall4cloud_biz/m/attach_file",method:"post",data:p})}function pt(p){return y({url:"/mall4cloud_biz/m/attach_file/page",method:"get",params:p})}function dt(p){return y({url:"/mall4cloud_biz/m/attach_file/update_file",method:"put",data:p})}function ct(p){return y({url:"/mall4cloud_biz/m/attach_file",method:"delete",params:p})}const mt={class:"file-group"},ft={class:"upload-btn"},gt={class:"up-btn"},bt={class:"img-group-box"},_t={class:"left-sidebar"},ht={class:"group-list"},yt=["onClick"],vt={class:"sidebar-operate"},Ft=["onClick"],It=["onClick"],kt={key:0,class:"pick-block",name:"pick"},xt={class:"elx-main elx-img-list"},Gt={key:0,class:"elx-img-list-loading"},zt=["onClick"],Vt=["src"],Ct=["onClick"],Nt={class:"operate"},$t=["onClick"],Lt={key:1,class:"empty"},Tt={class:"elx-foot"},Ut={key:1,class:"upload-block",name:"upload"},wt={class:"elx-main"},Et={class:"upload-title"},Pt={class:"file-gropu-btn"},St={key:0,class:"sel-group-name"},Rt={class:"upload-tip"},Ot={class:"elx-foot"},Bt={class:"dialog-footer"},qt={class:"dialog-footer"},jt={__name:"index",emits:["refreshPic"],setup(p,{expose:k,emit:K}){const x=K,e=ge({fileList:[],images:[],dataForm:{policy:"",signature:"",key:"",ossaccessKeyId:"",dir:"",host:"",attachFileGroupId:0},groupList:[],attachFiles:[],resourcesUrl:"http://192.168.1.80:9000/mall4cloud",resourcesActionType:"1",showGroupVisible:!1,selectGroup:!1,createGroup:!1,groupForm:{attachFileGroupId:"",name:""},groupId:null,oriImgName:null,rules:{name:[{required:!0,message:"分组名称不能为空",trigger:"blur"},{min:0,max:6,message:"长度在1-6个字符",trigger:"blur"}],attachFileGroupId:[{required:!0,message:"请选择分组",trigger:"change"}]},options:{multiple:!0,limit:20,maxSize:2,activeTab:"pick",enableUpload:!1,callback:null},newImgName:"",ossList:null,isTrue:!0,imageObject:null,changeNameVisible:!1,type:2,fileName:"",listType:"picture",isLoading:!0,visible:!1,disabled:!1,notImg:!1,uploadSuccessCount:0,imgRes:[],page:{current:1,size:15,total:0}}),{fileList:T,images:G,dataForm:$,groupList:U,resourcesUrl:S,showGroupVisible:z,selectGroup:R,createGroup:w,groupForm:b,options:O,newImgName:E,imageObject:B,changeNameVisible:V,type:M,fileName:H,isLoading:ye,visible:P,disabled:ve,imgRes:ee,page:J}=be(e),te=Z(),Fe=(l,t)=>{e.visible=!0,e.isLoading=!1,e.images=[],e.type=l,l===1?(e.type=!0,e.disabled=!0):(e.type=!1,e.limit=t),e.fileList=[],e.page.current=1,X(),L()},X=()=>{ot().then(l=>{e.groupList=l})},le=l=>{e.dataForm.attachFileGroupId=l,e.options.activeTab="pick",L()},q=(l,t,d)=>{if(t||(e.groupForm.attachFileGroupId=null,e.groupForm.name=null),l===0)if(e.groupList.length)e.selectGroup=!0,e.createGroup=!1;else{h({message:"当前暂无分组可选择，请先创建分组",duration:1500}),e.showGroupVisible=!1;return}else l===1&&(e.createGroup=!0,e.selectGroup=!1,t&&(e.groupForm.name=e.groupList[d].name,e.groupForm.attachFileGroupId=t,e.groupId=t));e.showGroupVisible=!0},oe=Z(),Ie=()=>{oe.value.validate(l=>{if(l){if(e.selectGroup){if(!e.groupForm.attachFileGroupId){h({message:"请选择分组",type:"warning",duration:1e3});return}e.groupList.forEach(t=>{e.groupForm.attachFileGroupId==t.attachFileGroupId&&(e.groupForm.name=t.name)}),e.showGroupVisible=!1;return}if(e.createGroup){e.groupForm.name||h({message:"分组名称不能为空",type:"warning",duration:1e3});const t={attachFileGroupId:e.groupForm.attachFileGroupId,name:e.groupForm.name};(e.groupId?it(t):at(t)).then(()=>{h({message:r("table.actionSuccess"),type:"success",duration:1500,onClose:()=>{e.showGroupVisible=!1,X()}})})}}})},ke=l=>{pe.confirm(r("table.sureToDelete"),r("table.tips"),{confirmButtonText:r("table.confirm"),cancelButtonText:r("table.cancel"),type:"warning"}).then(()=>{st({attachFileGroupId:l}).then(()=>{h({message:r("table.actionSuccess"),type:"success",duration:1500,onClose:()=>{X(),W()}})})})},L=()=>{e.isLoading=!0;const l={pageNum:e.page.current?e.page.current:1,pageSize:e.page.size,fileName:e.fileName?e.fileName:null,fileGroupId:e.dataForm.attachFileGroupId||0};pt(l).then(t=>{e.imgRes=t.list,e.page.pages=t.pages,e.page.total=t.total,e.isLoading=!1})},ae=()=>{if(e.type)x("refreshPic",e.images[0].filePath);else{const l=e.images.map(t=>t.filePath).join(",");x("refreshPic",l)}e.visible=!1},xe=l=>{e.newImgName="",e.imageObject=l,e.isTrue=!0,e.changeNameVisible=!0,e.oriImgName=l.fileName,e.groupList.forEach(t=>{l.attachFileGroupId==t.attachFileGroupId?(e.groupForm.name=t.name,e.groupForm.attachFileGroupId=t.attachFileGroupId):(e.groupForm.name=null,e.groupForm.attachFileGroupId=null)})},Ge=()=>{if(!e.isTrue)return!1;e.isTrue=!1;const l={fileId:e.imageObject.fileId,fileName:e.newImgName?e.newImgName:e.oriImgName,attachFileGroupId:e.groupForm.attachFileGroupId};dt(l).then(()=>{e.newImgName="",e.isTrue=!0,e.changeNameVisible=!1,L()}).catch(()=>{e.isTrue=!0})},ze=l=>{pe.confirm(r("table.sureToDelete"),r("table.tips"),{confirmButtonText:r("table.confirm"),cancelButtonText:r("table.cancel"),type:"warning"}).then(()=>{ct({fileId:l}).then(()=>{e.images=[],W()})})},ie=()=>{e.options.activeTab="upload",e.dataForm.attachFileGroupId=null,e.fileList=[]},{proxy:Ve}=tt(),Q=l=>{if(e.type)Ce(),e.images=[],e.disabled=!1;else{const t=Ne(l);if(t>=0){l.selected=!1,e.images.splice(t,1);return}}if(!e.type&&e.images.length>=e.limit)return h(r("biz.imgbox.superiorLimit")),!1;e.images.push(JSON.parse(JSON.stringify(l))),l.selected=!0,Ve.$forceUpdate()},Ce=()=>{e.type&&e.imgRes.forEach(t=>{t.selected=!1})},W=()=>{e.page.current=1,L()},Ne=l=>{for(let t=0;t<e.images.length;t++)if(e.images[t].fileId===l.fileId)return t;return-1},$e=l=>{e.page.current=l,L()},Le=()=>{const l=e.fileList.length;lt(l).then(t=>{e.resourcesActionType==="0"&&(e.dataForm.policy=t.policy,e.dataForm.signature=t.signature,e.dataForm.ossaccessKeyId=t.accessid,e.dataForm.dir=t.dir),e.ossList=t.ossList,e.notImg=!0,he(()=>{te.value.submit()})})},Te=l=>{const t=l.file,d=t.type.split("/"),v=Object.assign({fileType:d[1],fileName:t.name,fileSize:t.size,type:1});if(e.ossList.length<=0&&h("数据异常，请刷洗后重试"),e.resourcesActionType==="0"){v.filePath="/"+e.dataForm.dir+e.ossList[0].fileName;const c=new FormData;c.append("policy",e.dataForm.policy),c.append("signature",e.dataForm.signature),c.append("ossaccessKeyId",e.dataForm.ossaccessKeyId),c.append("dir",e.dataForm.dir),c.append("host",e.resourcesUrl),c.append("key",e.ossList[0].dir+e.ossList[0].fileName),c.append("file",t),rt(e.resourcesUrl,c).then(()=>{}).catch(_=>{_||l.onError()})}else v.filePath="/"+e.ossList[0].dir+e.ossList[0].fileName,nt(e.ossList[0].actionUrl,t).then(()=>{});e.attachFiles.push(v),e.ossList.splice(0,1),e.ossList<=0&&l.onSuccess()},Ue=l=>l.type.split("/")[0]!=="image"?(e.notImg&&(h(r("biz.imgbox.onlyPictures"),!0),e.notImg=!1),!1):l.size/(1024*1024)<2?!0:(h(e.uploadSizeTip()),!1),se=()=>e.options.multiple?e.options.limit-e.images.length:1,we=()=>r("biz.imgbox.onlySupported")+" jpg/png/gif "+r("biz.imgbox.pic"),Ee=()=>r("biz.imgbox.notExceed")+"2M",Pe=()=>{const l=[we(),Ee()];if(!e.options.multiple)return l.join("，");e.images.length>0&&l.push(r("biz.imgbox.alreadyExist")+e.images.length+r("biz.imgbox.unit"));const t=e.fileList?e.fileList.length:0;return t>0&&l.push(r("biz.imgbox.soonUpload")+t+r("biz.imgbox.unit")),l.push(r("biz.imgbox.remainder")+(e.options.limit-e.images.length-t)+r("biz.imgbox.unit")+r("biz.imgbox.upload")),l.join("，")},Se=(l,t,d)=>{throw h(r("biz.imgbox.requestError"),!0),l},Re=(l,t,d)=>{const v=[];d.forEach(_=>{v.push(_.name)});const c=[];e.attachFiles.forEach(_=>{v.indexOf(_.fileName)!==-1&&(_.attachFileGroupId=e.groupForm.attachFileGroupId,c.push(_))}),ut(c).then(_=>{e.attachFiles=[],e.options.activeTab="pick",e.dataForm.attachFileGroupId=0,L()}),e.disabled=!0,e.fileList=[],e.page.current=1},Oe=()=>{h(r("biz.imgbox.maxSelect")+se()+r("biz.imgbox.unit")+r("biz.imgbox.upload"))};return k({init:Fe}),(l,t)=>{const d=Ke,v=Me,c=He,_=Je,ne=Xe,Be=Qe,qe=We,je=_e("Plus"),De=ce,Ae=Ye,re=Ze,ue=et,Y=me;return u(),I(Y,{modelValue:a(P),"onUpdate:modelValue":t[16]||(t[16]=o=>N(P)?P.value=o:null),title:l.$t("biz.imgbox.picManager"),class:"component-imgbox",top:"10vh","append-to-body":a(P)},{default:i(()=>[n("div",mt,[n("div",ft,[n("div",gt,[s(d,{type:"primary",plain:"",class:"el-icon-top",onClick:ie},{default:i(()=>t[17]||(t[17]=[f(" 上传图片 ")])),_:1,__:[17]}),s(d,{class:"el-icon-plus",onClick:t[0]||(t[0]=o=>q(1))},{default:i(()=>t[18]||(t[18]=[f(" 新建分组 ")])),_:1,__:[18]})]),s(_,{inline:!0,model:a($),class:"demo-form-inline form"},{default:i(()=>[s(c,null,{default:i(()=>[s(v,{modelValue:a(H),"onUpdate:modelValue":t[1]||(t[1]=o=>N(H)?H.value=o:null),placeholder:l.$t("biz.imgbox.picName"),clearable:""},null,8,["modelValue","placeholder"])]),_:1}),s(c,null,{default:i(()=>[s(d,{type:"primary",onClick:W},{default:i(()=>[f(m(l.$t("biz.imgbox.query")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),n("div",bt,[n("div",_t,[n("div",ht,[n("div",{class:de(["group-item",a($).attachFileGroupId===0?"active":""])},[n("span",{class:"group-name",onClick:t[2]||(t[2]=o=>le(0))},"全部图片")],2),(u(!0),g(D,null,A(a(U),(o,j)=>(u(),g("div",{key:j,class:de(["group-item",a($).attachFileGroupId===o.attachFileGroupId?"active":""])},[n("span",{class:"group-name",onClick:C=>le(o.attachFileGroupId)},m(o.name),9,yt),n("span",vt,[n("i",{class:"el-icon-edit",onClick:C=>q(1,o.attachFileGroupId,j)},null,8,Ft),n("i",{class:"el-icon-delete",onClick:C=>ke(o.attachFileGroupId)},null,8,It)])],2))),128))])]),a(O).activeTab==="pick"?(u(),g("div",kt,[n("div",xt,[a(ye)?(u(),g("div",Gt,t[19]||(t[19]=[n("div",{class:"el-icon-loading"},null,-1)]))):F("",!0),(u(!0),g(D,null,A(a(ee),(o,j)=>(u(),g("div",{key:j,class:"img-item"},[n("div",{class:"thumb-wp",onClick:C=>Q(o)},[n("img",{src:o.filePath.indexOf("http")===-1?a(S)+o.filePath:o.filePath,alt:"img.name"},null,8,Vt)],8,zt),n("div",{class:"title",onClick:C=>Q(o)},m(o.fileName),9,Ct),n("div",Nt,[s(ne,{type:"info",class:"edit",onClick:C=>xe(o)},{default:i(()=>[f(m(l.$t("table.edit")),1)]),_:2},1032,["onClick"]),s(ne,{type:"danger",class:"del",onClick:C=>ze(o.fileId)},{default:i(()=>[f(m(l.$t("table.delete")),1)]),_:2},1032,["onClick"])]),o.selected?(u(),g("span",{key:0,class:"selected",onClick:C=>Q(o)},t[20]||(t[20]=[n("span",{class:"icon el-icon-check"},null,-1)]),8,$t)):F("",!0)]))),128)),a(ee).length?F("",!0):(u(),g("div",Lt," 暂无图片 "))]),s(Be,{layout:"total, prev, pager, next","current-page":a(J).current,"page-size":a(J).size,total:a(J).total,onCurrentChange:$e},null,8,["current-page","page-size","total"]),n("div",Tt,[a(M)?(u(),I(d,{key:1,type:"primary",disabled:a(ve),onClick:ae},{default:i(()=>[f(m(l.$t("table.confirm")),1)]),_:1},8,["disabled"])):(u(),I(qe,{key:0,value:a(G).length,class:"item"},{default:i(()=>[s(d,{type:"primary",disabled:a(G).length==0,onClick:ae},{default:i(()=>[f(m(l.$t("table.confirm")),1)]),_:1},8,["disabled"])]),_:1},8,["value"])),s(d,{type:"primary",plain:"",onClick:ie},{default:i(()=>[f(m(l.$t("biz.imgbox.uploadPic")),1)]),_:1})])])):F("",!0),a(O).activeTab==="upload"?(u(),g("div",Ut,[n("div",wt,[n("div",Et,m(l.$t("biz.imgbox.selectLocalPic")),1),s(Ae,{ref_key:"uploadRef",ref:te,"file-list":a(T),"onUpdate:fileList":t[3]||(t[3]=o=>N(T)?T.value=o:null),class:"upload-img-preview","list-type":"picture-card",accept:"image/*",action:"","http-request":Te,multiple:!0,"auto-upload":!1,limit:se(),"before-upload":Ue,"on-success":Re,"on-error":Se,"on-exceed":Oe},{default:i(()=>[s(De,{class:"el-icon-plus"},{default:i(()=>[s(je)]),_:1})]),_:1},8,["file-list","limit"]),n("div",Pt,[a(b).name?(u(),g("span",St,m(a(b).name),1)):F("",!0),s(d,{type:"primary",link:"",onClick:t[4]||(t[4]=o=>q(0))},{default:i(()=>t[21]||(t[21]=[f(" 选择分组 ")])),_:1,__:[21]}),s(d,{type:"primary",link:"",onClick:t[5]||(t[5]=o=>q(1))},{default:i(()=>t[22]||(t[22]=[f(" 新建分组 ")])),_:1,__:[22]})]),n("div",Rt,m(Pe()),1),n("div",Ot,[s(d,{type:"primary",onClick:Le},{default:i(()=>[f(m(l.$t("biz.imgbox.confirmUpload")),1)]),_:1})])])])):F("",!0)]),s(Y,{modelValue:a(z),"onUpdate:modelValue":t[10]||(t[10]=o=>N(z)?z.value=o:null),title:a(R)?"选择分组":a(w)?"新建分组":"","append-to-body":a(z)},{footer:i(()=>[n("div",Bt,[s(d,{onClick:t[8]||(t[8]=o=>z.value=!1)},{default:i(()=>[f(m(l.$t("table.cancel")),1)]),_:1}),s(d,{type:"primary",onClick:t[9]||(t[9]=o=>Ie())},{default:i(()=>[f(m(l.$t("table.confirm")),1)]),_:1})])]),default:i(()=>[s(_,{ref_key:"groupFormRef",ref:oe,model:a(b),"label-width":"90px",style:{width:"400px"}},{default:i(()=>[a(w)?(u(),I(c,{key:0,label:"分组名称",prop:"name"},{default:i(()=>[s(v,{modelValue:a(b).name,"onUpdate:modelValue":t[6]||(t[6]=o=>a(b).name=o),placeholder:"请输入分组名称"},null,8,["modelValue"])]),_:1})):F("",!0),a(R)?(u(),I(c,{key:1,label:"选择分组"},{default:i(()=>[s(ue,{modelValue:a(b).attachFileGroupId,"onUpdate:modelValue":t[7]||(t[7]=o=>a(b).attachFileGroupId=o),placeholder:"请选择"},{default:i(()=>[(u(!0),g(D,null,A(a(U),o=>(u(),I(re,{key:o.attachFileGroupId,label:o.name,value:o.attachFileGroupId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):F("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title","append-to-body"])]),s(Y,{visible:a(V),"onUpdate:visible":t[15]||(t[15]=o=>N(V)?V.value=o:null),title:l.$t("biz.imgbox.revisePicName"),"close-on-click-modal":!1,top:"200px","append-to-body":a(P),width:"600px"},{footer:i(()=>[n("span",qt,[s(d,{onClick:t[13]||(t[13]=o=>V.value=!1)},{default:i(()=>[f(m(l.$t("table.cancel")),1)]),_:1}),s(d,{onClick:t[14]||(t[14]=o=>Ge())},{default:i(()=>[f(m(l.$t("table.confirm")),1)]),_:1})])]),default:i(()=>[a(V)?(u(),I(_,{key:0,ref:"imgDataForm",model:a(B),"label-width":"80px"},{default:i(()=>[s(c,{label:l.$t("biz.imgbox.oldName")},{default:i(()=>[n("span",null,m(a(B).fileName),1)]),_:1},8,["label"]),s(c,{label:l.$t("biz.imgbox.revName")},{default:i(()=>[s(v,{modelValue:a(E),"onUpdate:modelValue":t[11]||(t[11]=o=>N(E)?E.value=o:null),placeholder:l.$t("biz.imgbox.inputNewName"),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(c,{label:"选择分组"},{default:i(()=>[s(ue,{modelValue:a(b).attachFileGroupId,"onUpdate:modelValue":t[12]||(t[12]=o=>a(b).attachFileGroupId=o),placeholder:"请选择"},{default:i(()=>[(u(!0),g(D,null,A(a(U),o=>(u(),I(re,{key:o.attachFileGroupId,label:o.name,value:o.attachFileGroupId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])):F("",!0)]),_:1},8,["visible","title","append-to-body"])]),_:1},8,["modelValue","title","append-to-body"])}}},Dt=fe(jt,[["__scopeId","data-v-3a600fe2"]]);const At={class:"component-img-upload"},Kt={class:"plugin-images"},Mt=["src"],Ht=["src"],Jt={__name:"index",props:{modelValue:{default:"",type:String},disabled:{default:!1,type:Boolean}},emits:"update:modelValue",setup(p,{emit:k}){const K=k,x=p,e=ge({resourcesUrl:"http://192.168.1.80:9000/mall4cloud",elxImgboxVisible:!1,visible:!1}),{elxImgboxVisible:T,visible:G}=be(e),$=Z(),U=()=>{if(x.disabled)return z(),!1;e.elxImgboxVisible=!0,he(()=>{$.value.init(1)})},S=()=>x.modelValue?x.modelValue.indexOf("http://")===0||x.modelValue.indexOf("https://")===0?x.modelValue:e.resourcesUrl+x.modelValue:"",z=()=>{e.visible=!0},R=w=>{K("update:modelValue",w)};return(w,b)=>{const O=_e("Plus"),E=ce,B=Dt,V=me;return u(),g("div",At,[n("div",Kt,[n("div",{tabindex:"0",class:"el-upload el-upload--text",onClick:U},[p.modelValue?(u(),g("img",{key:0,src:S(),class:"pic"},null,8,Mt)):(u(),I(E,{key:1,class:"el-icon-plus pic-uploader-icon"},{default:i(()=>[s(O)]),_:1}))])]),a(T)?(u(),I(B,{key:0,ref_key:"elxImgboxRef",ref:$,onRefreshPic:R},null,512)):F("",!0),s(V,{modelValue:a(G),"onUpdate:modelValue":b[0]||(b[0]=M=>N(G)?G.value=M:null),"append-to-body":a(G)},{default:i(()=>[n("img",{width:"100%",src:S(),alt:""},null,8,Ht)]),_:1},8,["modelValue","append-to-body"])])}}},ll=fe(Jt,[["__scopeId","data-v-866a3018"]]);export{ll as _};

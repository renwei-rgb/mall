import{_ as W}from"./index-17e7a6f7.js";import{a as p,q as Y,r as Z,D as ee,s as te,p as ae,G as oe}from"./element-plus@2.9.10_vue@3.5.14-e58ff881.js";import{_ as re}from"./index-e4ea1e4c.js";import{s as f,_ as le}from"./index-6f2da097.js";import{$ as se}from"./_t-d5227884.js";import{q as de,D as ne,b as S,y as o,a as N}from"./@vue_reactivity@3.5.14-2213b677.js";import{o as c,c as v,i as l,I as m,a as C,M as g,H as I,L as b,F as ue,X as me,n as $}from"./@vue_runtime-core@3.5.14-81aa8ddd.js";import{U,s as ie}from"./@vue_shared@3.5.14-94c2c668.js";function $e(i){return f({url:"/mall4cloud_product/admin/attr/page",method:"get",params:i})}function ce(i){return f({url:"/mall4cloud_product/admin/attr",method:"get",params:{attrId:i}})}function pe(i){return f({url:"/mall4cloud_product/admin/attr",method:"post",data:i})}function ge(i){return f({url:"/mall4cloud_product/admin/attr",method:"put",data:i})}function Ue(i){return f({url:"/mall4cloud_product/admin/attr",method:"delete",params:{attrId:i}})}const fe={class:"component-attr-add-or-update"},ye={class:"attr-int"},_e={key:0,class:"attr-val"},Ve={class:"attr-scr"},he={class:"dialog-footer"},ve={__name:"add-or-update",emits:["refreshDataList"],setup(i,{expose:E,emit:O}){const D=O,t=de({visible:!1,dataForm:{attrId:0,attrType:1,attrValues:[],categoryIds:[],desc:"",name:"",searchType:1},rules:{name:[{required:!0,message:"请输入属性名称",trigger:"blur"}]},attrValue:null,selectedCategories:[],categorySelectorVisible:!1}),{visible:y,dataForm:n,rules:R,attrValue:_,selectedCategories:B,categorySelectorVisible:x}=ne(t),V=S(),q=a=>{t.dataForm.attrId=a||0,t.visible=!0,$(()=>{if(V.value.resetFields(),!t.dataForm.attrId){t.attrValue=null,t.dataForm.attrValues=[];return}ce(a).then(e=>{t.dataForm=e,t.dataForm.attrValues=e.attrValues?e.attrValues:[],j(e.categories)})})},j=a=>{if(a.length){let e={};const u=[];let s=[];a.forEach((d,w)=>{u.push(d.categoryId),d.pathNames&&d.pathNames.length&&(d.pathNames[0]&&s.push(d.pathNames[0]),d.pathNames[1]&&s.push(d.pathNames[1])),d.name&&s.push(d.name),e.firstCategoryName=s[0],e.secondCategoryName=s[1],e.threeCategoryName=s[2],t.selectedCategories.push(e),s=[],e={}}),t.dataForm.categoryIds=u}else t.dataForm.categoryIds=[]},A=()=>{t.dataForm={attrId:0,attrType:1,attrValues:[],categoryIds:[],desc:"",name:"",searchType:1},t.selectedCategories=[]},k=S(),L=()=>{t.categorySelectorVisible=!0,$(()=>{k.value.init()})},M=(a,e)=>{t.categorySelectorVisible=!1;const u={};u.firstCategoryName=a[0],u.secondCategoryName=a[1],u.threeCategoryName=a[2],t.selectedCategories.length&&t.dataForm.categoryIds.forEach((s,d)=>{s===e&&(t.selectedCategories.splice(d,1),t.dataForm.categoryIds.splice(d,1))}),t.dataForm.categoryIds.push(e),t.selectedCategories.push(u)},z=a=>{t.selectedCategories.splice(a,1),t.dataForm.categoryIds.splice(a,1)},G=a=>{if(!a)return p({message:"添加属性值为空",type:"warning"});t.dataForm.attrValues.forEach((e,u)=>{e.value===a&&(t.dataForm.attrValues.splice(u,1),p({message:"属性值重复",type:"warning"}))}),t.dataForm.attrValues.push({value:a}),t.attrValue=""},P=a=>{t.dataForm.attrValues.splice(a,1)},H=a=>{t.dataForm.attrValues[a].value||(p({message:"已创建的属性值不能为空！请重新创建",type:"warining",duration:1500}),t.dataForm.attrValues.splice(a,1))},X=()=>{V.value.validate(a=>{if(!a)return;if(t.dataForm.attrType===1&&(!t.dataForm.categoryIds||!t.dataForm.categoryIds.length)){p({message:"请至少选择一个分类",duration:1500});return}if(t.dataForm.attrType===1&&t.dataForm.searchType===1&&!t.dataForm.attrValues.length){p({message:"请至少创建一个属性值",duration:1500});return}(t.dataForm.attrId?ge(t.dataForm):pe(t.dataForm)).then(()=>{p({message:se("table.actionSuccess"),type:"success",duration:1500,onClose:()=>{t.visible=!1,D("refreshDataList"),V.value.resetFields()}})})})};return E({init:q}),(a,e)=>{const u=Y,s=Z,d=ee,w=re,h=te,J=ae,K=oe,Q=W;return c(),v("div",fe,[l(K,{modelValue:o(y),"onUpdate:modelValue":e[8]||(e[8]=r=>N(y)?y.value=r:null),title:o(n).attrId?a.$t("table.edit"):a.$t("table.create"),"close-on-click-modal":!1,top:"8vh","destroy-on-close":!0,width:"750px",onClose:A},{footer:m(()=>[C("div",he,[l(h,{onClick:e[6]||(e[6]=r=>y.value=!1)},{default:m(()=>[g(U(a.$t("table.cancel")),1)]),_:1}),l(h,{type:"primary",onClick:e[7]||(e[7]=r=>X())},{default:m(()=>[g(U(a.$t("table.confirm")),1)]),_:1})])]),default:m(()=>[l(J,{ref_key:"dataFormRef",ref:V,rules:o(R),model:o(n),"label-position":"left","label-width":"80px",style:{"min-width":"600px",width:"600px","margin-left":"35px"}},{default:m(()=>[l(s,{label:a.$t("product.attr.name"),prop:"name"},{default:m(()=>[l(u,{modelValue:o(n).name,"onUpdate:modelValue":e[0]||(e[0]=r=>o(n).name=r),maxlength:"20","show-word-limit":"",placeholder:"请输入属性名称"},null,8,["modelValue"])]),_:1},8,["label"]),l(s,{label:a.$t("product.attr.desc"),prop:"desc"},{default:m(()=>[l(u,{modelValue:o(n).desc,"onUpdate:modelValue":e[1]||(e[1]=r=>o(n).desc=r),type:"textarea",rows:2,maxlength:"30","show-word-limit":"",placeholder:"请输入新增属性的相关描述，30字以内"},null,8,["modelValue"])]),_:1},8,["label"]),o(n).attrType===1?(c(),I(s,{key:0,label:a.$t("product.attr.searchType"),prop:"searchType"},{default:m(()=>[l(d,{modelValue:o(n).searchType,"onUpdate:modelValue":e[2]||(e[2]=r=>o(n).searchType=r),label:0},{default:m(()=>e[9]||(e[9]=[g(" 不需要 ")])),_:1,__:[9]},8,["modelValue"]),l(d,{modelValue:o(n).searchType,"onUpdate:modelValue":e[3]||(e[3]=r=>o(n).searchType=r),label:1},{default:m(()=>e[10]||(e[10]=[g(" 需要 ")])),_:1,__:[10]},8,["modelValue"])]),_:1},8,["label"])):b("",!0),o(n).attrType===1?(c(),I(s,{key:1,label:a.$t("product.category.categoryParent")},{default:m(()=>[l(w,{"selected-categories":o(B),multiple:!0,onSelectOrReviseCategory:L,onDeleteCategoryItemOfSelected:z},null,8,["selected-categories"])]),_:1},8,["label"])):b("",!0),l(s,{label:a.$t("product.attr.attrValue"),prop:"attrValues"},{default:m(()=>[C("div",ye,[l(u,{modelValue:o(_),"onUpdate:modelValue":e[4]||(e[4]=r=>N(_)?_.value=r:null),clearable:"",maxlength:"20","show-word-limit":"",placeholder:"请输入要添加的属性值，20字以内"},null,8,["modelValue"]),l(h,{icon:"el-icon-plus",class:"add-btn",onClick:e[5]||(e[5]=r=>G(o(_)))},{default:m(()=>e[11]||(e[11]=[g(" 添加 ")])),_:1,__:[11]})]),o(n).attrValues.length?(c(),v("div",_e,[C("div",Ve,[(c(!0),v(ue,null,me(o(n).attrValues,(r,T)=>(c(),v("div",{key:r.attrValueId,class:ie(["attr-val-item",r.error?"error":""])},[l(u,{modelValue:r.value,"onUpdate:modelValue":F=>r.value=F,maxlength:"20","show-word-limit":"",placeholder:"请输入要添加的属性值，20字以内",onBlur:F=>H(T)},null,8,["modelValue","onUpdate:modelValue","onBlur"]),l(h,{type:"primary",link:"",class:"txt-del-btn",onClick:F=>P(T)},{default:m(()=>e[12]||(e[12]=[g(" 删除 ")])),_:2,__:[12]},1032,["onClick"])],2))),128))])])):b("",!0)]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"]),o(x)?(c(),I(Q,{key:0,ref_key:"categorySelectorRef",ref:k,onGetCategorySelected:M},null,512)):b("",!0)])}}},be=le(ve,[["__scopeId","data-v-63c9896a"]]),Ee=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"}));export{be as A,Ee as a,Ue as d,$e as p};

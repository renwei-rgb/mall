var W=Object.defineProperty;var M=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var q=(u,p,s)=>p in u?W(u,p,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[p]=s,H=(u,p)=>{for(var s in p||(p={}))Y.call(p,s)&&q(u,s,p[s]);if(M)for(var s of M(p))Z.call(p,s)&&q(u,s,p[s]);return u};import{a as ee,D as te,F as oe,r as le,q as ae,H as re,v as ne,w as ie,C as me,J as pe,p as se,s as de,G as ue}from"./element-plus@2.9.10_vue@3.5.14-e58ff881.js";import{_ as ce}from"./index-4e3cd12b.js";import{a as fe}from"./@vue_runtime-dom@3.5.14-7e661aa4.js";import{m as ve,t as _e,n as Fe,c as ye,o as be,q as Ve}from"./index-6f2da097.js";import{$ as ge}from"./_t-d5227884.js";import{q as w,D as Ie,b as Le,y as o,a as C}from"./@vue_reactivity@3.5.14-2213b677.js";import{w as Ue,o as c,H as v,I as m,a as Ee,i,M as V,c as h,F as S,X as $,L as g,n as Me}from"./@vue_runtime-core@3.5.14-81aa8ddd.js";import{U as I}from"./@vue_shared@3.5.14-94c2c668.js";import"./@vue-06e0889c.js";import"./lodash-es@4.17.21-e2bba480.js";import"./@vueuse_shared@9.13.0_vue@3.5.14-f0e16060.js";import"./@vueuse_core@9.13.0_vue@3.5.14-f98106e7.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.14-71698097.js";import"./@sxzz_popperjs-es@2.11.7-7c8154ca.js";import"./@ctrl_tinycolor@3.6.1-86a38320.js";import"./dayjs@1.11.13-c188735a.js";import"./@intlify_core-base@9.2.2-93f07292.js";import"./@intlify_message-compiler@9.2.2-228be59b.js";import"./@intlify_shared@9.2.2-29bf9385.js";import"./source-map@0.6.1-02de534d.js";import"./@intlify_devtools-if@9.2.2-22850edc.js";import"./async-validator@4.2.5-774c2804.js";import"./memoize-one@6.0.0-297ddbcb.js";import"./normalize-wheel-es@1.2.0-ed76fb12.js";import"./@floating-ui_dom@1.7.0-586b25a4.js";import"./@floating-ui_core@1.7.0-7ff28a0e.js";import"./@floating-ui_utils@0.2.9-746d277c.js";import"./pinia@2.3.1_vue@3.5.14-4833dba6.js";import"./vue-demi@0.14.10_vue@3.5.14-71ba0ef2.js";import"./vue-router@4.5.1_vue@3.5.14-0f6ed4bc.js";import"./vue-i18n@9.2.2_vue@3.5.14-cf205787.js";import"./vue@3.5.14-dfc94670.js";import"./vue-cookies@1.8.3-f66fc855.js";import"./@element-plus_icons-vue@2.1.0_vue@3.5.14-0cb2d1d1.js";import"./axios@1.4.0-e76ab20a.js";import"./qs@6.11.2-13302ec8.js";import"./side-channel@1.1.0-f5737a48.js";import"./es-errors@1.3.0-c75f5a96.js";import"./object-inspect@1.13.4-95f40997.js";import"./crypto-js@4.1.1-4a4e7433.js";import"./side-channel-list@1.0.0-2bff8a80.js";import"./side-channel-map@1.0.1-ef12932d.js";import"./get-intrinsic@1.3.0-829e561c.js";import"./es-object-atoms@1.1.1-11ea1ab9.js";import"./math-intrinsics@1.1.0-9389030e.js";import"./gopd@1.2.0-f4eec54c.js";import"./es-define-property@1.0.1-88d30046.js";import"./has-symbols@1.1.0-1e41ff1e.js";import"./get-proto@1.0.1-a9f527cc.js";import"./dunder-proto@1.0.1-62f72dc7.js";import"./call-bind-apply-helpers@1.0.2-03b6ca7f.js";import"./function-bind@1.1.2-48f717dc.js";import"./hasown@2.0.2-f810df7c.js";import"./call-bound@1.0.4-15e4d619.js";import"./side-channel-weakmap@1.0.2-460ea971.js";import"./big.js@6.2.1-49ab783c.js";import"./dompurify@3.0.3-4985f3f0.js";import"./moment@2.29.4-4717c495.js";const qe={class:"dialog-footer"},Nt={__name:"add-or-update",emits:["refreshDataList"],setup(u,{expose:p,emit:s}){const k=s,t=w({visible:!1,param:{sysType:1},dataForm:{menuId:0,type:1,typeList:["目录","菜单"],title:"",name:"",parentId:0,url:"",componentUrl:"",isMenuHide:"",seq:0,icon:"",iconList:[]},menuHideOpts:[{value:0,label:"否"},{value:1,label:"是"}],menuList:[],selectedMenu:[],menuListTreeProps:{value:"id",label:"title",checkStrictly:!0},iconPopoverVisible:[]}),{visible:F,dataForm:l,menuHideOpts:R,menuList:T,selectedMenu:b,menuListTreeProps:D}=Ie(t),N=w({title:[{required:!0,validator:(n,e,r)=>{e?r():r(new Error("菜单标题不能为空"))},trigger:"blur"}],name:[{required:!0,validator:(n,e,r)=>{e?r():r(new Error("菜单名称不能为空"))},trigger:"blur"}],url:[{required:!0,validator:(n,e,r)=>{/\S/.test(e)?r():r(new Error("菜单URL不能为空"))},trigger:"blur"}],componentUrl:[{required:!0,validator:(n,e,r)=>{t.dataForm.type===1&&!/\S/.test(e)?r(new Error("组件路径不能为空")):r()},trigger:"blur"}],isMenuHide:[{required:!0,validator:(n,e,r)=>{t.dataForm.isMenuHide===""?r(new Error("菜单是否隐藏不能为空")):r()},trigger:"blur"}]}),y=Le();Ue(()=>t.visible,n=>{n===!1&&(y.value.resetFields(),P())});const B=n=>{t.dataForm.menuId=n||0,t.visible=!0,Me(()=>{ve(H({},t.param)).then(e=>{e.forEach(r=>{r.title=r.meta.title}),t.menuList=_e(e),t.pageLoading=!1}),t.dataForm.menuId?Fe(n).then(e=>{e.component!=="Layout"?(t.dataForm.type=1,t.dataForm.componentUrl=e.component):(t.dataForm.type=0,t.dataForm.componentUrl=""),t.dataForm.menuId=e.menuId,t.dataForm.title=e.title,t.dataForm.name=e.name,t.dataForm.parentId=e.parentId,t.dataForm.url=e.path,t.dataForm.isMenuHide=e.hidden,t.dataForm.seq=e.seq,t.dataForm.icon=e.icon;const r=ye(t.menuList,e.parentId).reverse(),f=[];r.forEach(d=>{f.push(d.id)}),t.selectedMenu=f}):t.selectedMenu=[]})},P=()=>{t.dataForm={menuId:0,type:1,typeList:["目录","菜单"],title:"",name:"",parentId:0,url:"",componentUrl:"",isMenuHide:"",seq:0,icon:"",iconList:[]}},x=n=>{t.dataForm.parentId=n[n.length-1],t.dataForm.parentId===void 0&&(t.dataForm.parentId=0)},O=n=>{t.dataForm.icon=n},L=()=>{y.value.validate(n=>{if(n){let e="";parseInt(t.dataForm.type)===0?e="Layout":e=t.dataForm.componentUrl;let r="";parseInt(t.dataForm.type)===0?r=0:parseInt(t.dataForm.isMenuHide)===1?r=1:r=0;const f={menuId:t.dataForm.menuId||void 0,title:t.dataForm.title,name:t.dataForm.name,parentId:t.dataForm.parentId,component:e,path:t.dataForm.url,hidden:r,seq:t.dataForm.seq,sysType:1,icon:t.dataForm.icon};(t.dataForm.menuId?be(f):Ve(f)).then(()=>{ee({message:ge("table.actionSuccess"),type:"success",duration:1500,onClose:()=>{t.visible=!1,k("refreshDataList"),y.value.resetFields()}})})}})};return p({init:B}),(n,e)=>{const r=te,f=oe,d=le,_=ae,G=re,K=ne,J=ie,X=me,j=ce,z=pe,A=se,U=de,Q=ue;return c(),v(Q,{modelValue:o(F),"onUpdate:modelValue":e[12]||(e[12]=a=>C(F)?F.value=a:null),class:"component-shop-menu-add-or-update",title:o(l).menuId?n.$t("table.edit"):n.$t("table.create")},{footer:m(()=>[Ee("div",qe,[i(U,{onClick:e[10]||(e[10]=a=>F.value=!1)},{default:m(()=>[V(I(n.$t("table.cancel")),1)]),_:1}),i(U,{type:"primary",onClick:e[11]||(e[11]=a=>L())},{default:m(()=>[V(I(n.$t("table.confirm")),1)]),_:1})])]),default:m(()=>[i(A,{ref_key:"dataFormRef",ref:y,model:o(l),rules:N,"label-width":"80px",onKeyup:e[9]||(e[9]=fe(a=>L(),["enter"]))},{default:m(()=>[i(d,{label:"类型",prop:"type"},{default:m(()=>[i(f,{modelValue:o(l).type,"onUpdate:modelValue":e[0]||(e[0]=a=>o(l).type=a)},{default:m(()=>[(c(!0),h(S,null,$(o(l).typeList,(a,E)=>(c(),v(r,{key:E,label:E},{default:m(()=>[V(I(a),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(d,{label:o(l).typeList[o(l).type]+"标题",prop:"title"},{default:m(()=>[i(_,{modelValue:o(l).title,"onUpdate:modelValue":e[1]||(e[1]=a=>o(l).title=a),placeholder:o(l).typeList[o(l).type]+"标题"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(d,{label:o(l).typeList[o(l).type]+"名称",prop:"name"},{default:m(()=>[i(_,{modelValue:o(l).name,"onUpdate:modelValue":e[2]||(e[2]=a=>o(l).name=a),placeholder:o(l).typeList[o(l).type]+"名称"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(d,{label:"上级菜单"},{default:m(()=>[i(G,{modelValue:o(b),"onUpdate:modelValue":e[3]||(e[3]=a=>C(b)?b.value=a:null),clearable:"","expand-trigger":"hover",options:o(T),props:o(D),"change-on-select":"",onChange:x},null,8,["modelValue","options","props"])]),_:1}),i(d,{label:"菜单路由",prop:"url"},{default:m(()=>[i(_,{modelValue:o(l).url,"onUpdate:modelValue":e[4]||(e[4]=a=>o(l).url=a),placeholder:"菜单路由"},null,8,["modelValue"])]),_:1}),o(l).type===1?(c(),v(d,{key:0,label:"组件路径",prop:"componentUrl"},{default:m(()=>[i(_,{modelValue:o(l).componentUrl,"onUpdate:modelValue":e[5]||(e[5]=a=>o(l).componentUrl=a),placeholder:"组件路径"},null,8,["modelValue"])]),_:1})):g("",!0),o(l).type===1?(c(),v(d,{key:1,label:"菜单隐藏",prop:"isMenuHide"},{default:m(()=>[i(J,{modelValue:o(l).isMenuHide,"onUpdate:modelValue":e[6]||(e[6]=a=>o(l).isMenuHide=a),placeholder:"请选择"},{default:m(()=>[(c(!0),h(S,null,$(o(R),a=>(c(),v(K,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0),o(l).type!==2?(c(),v(d,{key:2,label:"排序号",prop:"seq"},{default:m(()=>[i(X,{modelValue:o(l).seq,"onUpdate:modelValue":e[7]||(e[7]=a=>o(l).seq=a),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1})):g("",!0),i(d,{label:"icon",prop:"icon"},{default:m(()=>[i(z,{ref:"iconListPopoverRef",placement:"top",trigger:"click",width:500,"popper-class":"mod-menu-home__icon-popover"},{reference:m(()=>[i(_,{modelValue:o(l).icon,"onUpdate:modelValue":e[8]||(e[8]=a=>o(l).icon=a),readonly:!0,maxlength:"32"},null,8,["modelValue"])]),default:m(()=>[i(j,{onSelectIcon:O})]),_:1},512)]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}};export{Nt as default};

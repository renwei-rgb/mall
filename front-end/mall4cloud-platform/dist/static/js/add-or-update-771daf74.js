var me=Object.defineProperty;var K=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var W=(r,p,m)=>p in r?me(r,p,{enumerable:!0,configurable:!0,writable:!0,value:m}):r[p]=m,Q=(r,p)=>{for(var m in p||(p={}))ge.call(p,m)&&W(r,m,p[m]);if(K)for(var m of K(p))ce.call(p,m)&&W(r,m,p[m]);return r};import{q as fe,r as Z,H as _e,s as ee,p as te,D as le,x as ye,A as be,G as oe,B as Ie,a as H,C as ve,e as Se}from"./element-plus@2.9.10_vue@3.5.14-e58ff881.js";import{_ as Ve}from"./index-d3432a72.js";import{v as xe}from"./@vue_runtime-dom@3.5.14-7e661aa4.js";import{B as Ce}from"./big.js@6.2.1-49ab783c.js";import{p as Ue}from"./list-cce0e6af.js";import{c as Le}from"./category-2962f30d.js";import{_ as he,t as Fe,c as Pe,s as E}from"./index-6f2da097.js";import{q as ae,D as se,b as j,y as o,a as F}from"./@vue_reactivity@3.5.14-2213b677.js";import{g as ke,n as A,o as x,H as h,I as s,a as I,i as a,M as g,J as X,L as w,c as Y}from"./@vue_runtime-core@3.5.14-81aa8ddd.js";import{_ as we}from"./index-f854da1e.js";import{$ as Ee}from"./_t-d5227884.js";import{U as J}from"./@vue_shared@3.5.14-94c2c668.js";const Te={class:"prods-select-body"},$e=["src"],De={__name:"index",props:{isSingle:{default:!1,type:Boolean},prodType:{default:null,type:Number},dataUrl:{default:"/prod/prod/page",type:String}},emits:["refreshSelectProds"],setup(r,{expose:p,emit:m}){const O=m,e=ae({visible:!1,resourcesUrl:"http://192.168.1.80:9000/mall4cloud",pageQuery:{pageSize:10,pageNum:1,spuStatus:1},pageVO:{list:[],total:0,pages:0},searchParam:{},dataForm:{name:"",product:""},singleSelectspuId:0,allData:[],selectProds:[],shopCategoryId:null,pageIndex:1,pageSize:10,totalPage:0,dataListLoading:!1,addOrUpdateVisible:!1,dataListSelections:[],categoryList:[],selectedCategory:[],categoryTreeProps:{value:"categoryId",label:"name"}}),{visible:U,pageQuery:y,pageVO:i,dataForm:_,singleSelectspuId:P,dataListLoading:T,categoryList:R,selectedCategory:v,categoryTreeProps:q}=se(e);ke(()=>{L()});const $=d=>{e.singleSelectspuId=0,e.selectProds=d,e.visible=!0,e.dataListLoading=!0,S(),e.selectProds&&e.selectProds.forEach(l=>{e.dataListSelections.push(l)}),L(),B()},B=()=>{Le().then(d=>{e.categoryList=Fe(d,"categoryId","parentId")})},D=j(),L=()=>{Ue(Q(Q({},e.pageQuery),e.searchParam)).then(d=>{e.pageVO=d,e.pageVO.list.forEach(l=>{l.priceFee=new Ce(l.priceFee).div(100).toFixed(2)}),e.dataListLoading=!1,e.selectProds&&A(()=>{e.selectProds.forEach(l=>{const b=e.pageVO.list.findIndex(f=>f.spuId===l.spuId);D.value.toggleRowSelection(e.pageVO.list[b])})})})},M=d=>{e.dataListSelections=[d]},c=d=>{e.pageVO.list.forEach(l=>{const b=d.findIndex(V=>V?V.spuId===l.spuId:!1),f=e.dataListSelections.findIndex(V=>V.spuId===l.spuId);b>-1&&f===-1?e.dataListSelections.push(l):b===-1&&f>-1&&e.dataListSelections.splice(f,1)})},t=d=>{e.shopCategoryId=d[d.length-1]},N=()=>{e.pageQuery.pageNum=1,e.searchParam={name:e.dataForm.name,categoryId:e.shopCategoryId},L()},S=()=>{e.name="",e.shopCategoryId=null,e.selectedCategory=Pe(e.categoryList,e.shopCategoryId,"categoryId").reverse()},C=()=>{e.name="",e.shopCategoryId=null},z=()=>{const d=[];e.dataListSelections.forEach(l=>{d.findIndex(f=>f.spuId===l.spuId)===-1&&d.push({spuId:l.spuId,name:l.spuName,imgUrls:l.imgUrls,mainImgUrl:l.mainImgUrl,activityId:l.activityId,prodType:l.prodType})}),O("refreshSelectProds",d),e.dataListSelections=[],e.visible=!1};return p({init:$}),(d,l)=>{const b=fe,f=Z,V=_e,n=ee,ne=te,de=le,k=ye,re=be,ie=Ve,ue=oe,pe=Ie;return x(),h(ue,{modelValue:o(U),"onUpdate:modelValue":l[8]||(l[8]=u=>F(U)?U.value=u:null),title:"商品选择",modal:!1,top:"4vh","close-on-click-modal":!1,width:"820px",onClose:C},{footer:s(()=>[I("span",null,[a(n,{onClick:l[6]||(l[6]=u=>U.value=!1)},{default:s(()=>l[12]||(l[12]=[g("取消")])),_:1,__:[12]}),a(n,{type:"primary",onClick:l[7]||(l[7]=u=>z())},{default:s(()=>l[13]||(l[13]=[g("确认")])),_:1,__:[13]})])]),default:s(()=>[a(ne,{inline:!0,model:o(_),class:"demo-form-inline"},{default:s(()=>[a(f,{label:"商品名称"},{default:s(()=>[a(b,{modelValue:o(_).name,"onUpdate:modelValue":l[0]||(l[0]=u=>o(_).name=u),modelModifiers:{trim:!0},placeholder:"商品名称",clearable:""},null,8,["modelValue"])]),_:1}),a(f,{label:"上级分类"},{default:s(()=>[a(V,{modelValue:o(v),"onUpdate:modelValue":l[1]||(l[1]=u=>F(v)?v.value=u:null),"expand-trigger":"hover",options:o(R),props:o(q),clearable:!0,onChange:t},null,8,["modelValue","options","props"])]),_:1}),a(f,null,{default:s(()=>[a(n,{type:"primary",onClick:N},{default:s(()=>l[9]||(l[9]=[g(" 查询 ")])),_:1,__:[9]}),a(n,{onClick:S},{default:s(()=>l[10]||(l[10]=[g(" 清空 ")])),_:1,__:[10]})]),_:1})]),_:1},8,["model"]),I("div",Te,[X((x(),h(re,{ref_key:"prodTableRef",ref:D,data:o(i).list,border:"","highlight-current-row":"",style:{width:"100%"},onSelectionChange:c},{default:s(()=>[r.isSingle?(x(),h(k,{key:0,width:"50","header-align":"center",align:"center"},{default:s(({row:u})=>[I("div",null,[a(de,{modelValue:o(P),"onUpdate:modelValue":l[2]||(l[2]=G=>F(P)?P.value=G:null),label:u.spuId,onChange:G=>M(u)},{default:s(()=>l[11]||(l[11]=[g("   ")])),_:2,__:[11]},1032,["modelValue","label","onChange"])])]),_:1})):w("",!0),r.isSingle?w("",!0):(x(),h(k,{key:1,type:"selection","header-align":"center",align:"center",width:"50"})),a(k,{align:"center",width:"140",label:"商品图片"},{default:s(({row:u})=>[I("img",{src:u.mainImgUrl,width:"100",height:"100"},null,8,$e)]),_:1}),a(k,{prop:"spuName","header-align":"center",align:"center",label:"商品名称"}),a(k,{prop:"priceFee","header-align":"center",align:"center",label:"商品价格",width:"200px"})]),_:1},8,["data"])),[[pe,o(T)]]),X(a(ie,{page:o(y).pageNum,"onUpdate:page":l[3]||(l[3]=u=>o(y).pageNum=u),limit:o(y).pageSize,"onUpdate:limit":l[4]||(l[4]=u=>o(y).pageSize=u),total:o(i).total,onPagination:l[5]||(l[5]=u=>L())},null,8,["page","limit","total"]),[[xe,o(i).total>0]])])]),_:1},8,["modelValue"])}}},Ne=he(De,[["__scopeId","data-v-908ed02b"]]);function nt(r){return E({url:"/mall4cloud_multishop/admin/index_img/page",method:"get",params:r})}function Oe(r){return E({url:"/mall4cloud_multishop/admin/index_img",method:"get",params:{imgId:r}})}function Re(r){return E({url:"/mall4cloud_multishop/admin/index_img",method:"post",data:r})}function qe(r){return E({url:"/mall4cloud_multishop/admin/index_img",method:"put",data:r})}function dt(r){return E({url:"/mall4cloud_multishop/admin/index_img",method:"delete",params:{imgId:r}})}const Be={key:0},Me=["src"],ze={class:"card-prod-bottom"},Qe={class:"card-prod-name"},He={key:1,class:"select-pro"},Je={class:"dialog-footer"},je={__name:"add-or-update",emits:["refreshDataList"],setup(r,{expose:p,emit:m}){const O=m,e=ae({canSubmit:!0,visible:!1,dataForm:{imgId:0,imgUrl:null,seq:0,imgType:0,status:1,spuId:null},relatedSpu:0,card:{id:0,pic:"",name:"",realData:{prod:[],shop:[],activity:[]}},prodSelectVisible:!1,prods:{},rules:{imgUrl:[{required:!0,message:"请选择轮播图图片",trigger:"blur"}]}}),{canSubmit:U,visible:y,dataForm:i,relatedSpu:_,prodSelectVisible:P,prods:T,rules:R}=se(e),v=j(),q=c=>{e.canSubmit=!0,e.visible=!0,e.dataForm.imgId=c||0,A(()=>{v.value.resetFields(),e.dataForm.imgId&&Oe(c).then(t=>{e.dataForm=t,e.prods=t.spu,e.relatedSpu=t.spu?1:0})})},$=j(),B=()=>{e.prodSelectVisible=!0,A(()=>{$.value.init()})},D=()=>{e.dataForm={imgId:0,imgUrl:null,seq:0,imgType:0,status:1,spuId:null}},L=c=>{e.prods=c[0],e.dataForm.spuId=e.prods.spuId},M=()=>{e.canSubmit=!1,v.value.validate(c=>{if(!c){e.canSubmit=!0;return}if(!e.dataForm.imgUrl){H({message:"请选择轮播图片",type:"warning",duration:1500}),e.canSubmit=!0;return}if(e.relatedSpu===1&&!e.dataForm.spuId){H({message:"请选择商品",type:"warning",duration:1500}),e.canSubmit=!0;return}const t=JSON.parse(JSON.stringify(e.dataForm));e.relatedSpu||(t.spu=null,t.spuId=null),(t.imgId?qe(t):Re(t)).then(()=>{H({message:Ee("table.actionSuccess"),type:"success",duration:1500,onClose:()=>{e.visible=!1,e.canSubmit=!0,O("refreshDataList"),v.value.resetFields()}})}).catch(()=>{e.canSubmit=!0})})};return p({init:q}),(c,t)=>{const N=we,S=Z,C=le,z=ve,d=ee,l=Se,b=Ne,f=te,V=oe;return x(),h(V,{modelValue:o(y),"onUpdate:modelValue":t[10]||(t[10]=n=>F(y)?y.value=n:null),title:o(i).attrId?c.$t("table.edit"):c.$t("table.create"),"close-on-click-modal":!1,"destroy-on-close":!0,top:"10vh",class:"comoonent-index-img-add-or-update",width:"750px",onClose:D},{footer:s(()=>[I("div",Je,[a(d,{onClick:t[8]||(t[8]=n=>y.value=!1)},{default:s(()=>[g(J(c.$t("table.cancel")),1)]),_:1}),a(d,{type:"primary",disabled:!o(U),onClick:t[9]||(t[9]=n=>M())},{default:s(()=>[g(J(c.$t("table.confirm")),1)]),_:1},8,["disabled"])])]),default:s(()=>[a(f,{ref_key:"dataFormRef",ref:v,rules:o(R),model:o(i),"label-width":"90px",style:{"min-width":"600px",width:"600px","margin-left":"35px"}},{default:s(()=>[a(S,{label:"轮播图片",prop:"imgUrl"},{default:s(()=>[a(N,{modelValue:o(i).imgUrl,"onUpdate:modelValue":t[0]||(t[0]=n=>o(i).imgUrl=n)},null,8,["modelValue"]),t[11]||(t[11]=I("div",{class:""}," 建议图片尺寸为710*780 ",-1))]),_:1,__:[11]}),a(S,{label:"平台",prop:"imgType"},{default:s(()=>[a(C,{modelValue:o(i).imgType,"onUpdate:modelValue":t[1]||(t[1]=n=>o(i).imgType=n),label:0},{default:s(()=>t[12]||(t[12]=[g(" 移动端 ")])),_:1,__:[12]},8,["modelValue"])]),_:1}),a(S,{label:"状态",prop:"status"},{default:s(()=>[a(C,{modelValue:o(i).status,"onUpdate:modelValue":t[2]||(t[2]=n=>o(i).status=n),label:0},{default:s(()=>t[13]||(t[13]=[g(" 禁用 ")])),_:1,__:[13]},8,["modelValue"]),a(C,{modelValue:o(i).status,"onUpdate:modelValue":t[3]||(t[3]=n=>o(i).status=n),label:1},{default:s(()=>t[14]||(t[14]=[g(" 正常 ")])),_:1,__:[14]},8,["modelValue"])]),_:1}),a(S,{label:"排序",prop:"seq"},{default:s(()=>[a(z,{modelValue:o(i).seq,"onUpdate:modelValue":t[4]||(t[4]=n=>o(i).seq=n),min:0,"controls-position":"right",precision:0},null,8,["modelValue"])]),_:1}),a(S,{label:"类型",prop:""},{default:s(()=>[a(C,{modelValue:o(_),"onUpdate:modelValue":t[5]||(t[5]=n=>F(_)?_.value=n:null),label:0},{default:s(()=>t[15]||(t[15]=[g(" 无 ")])),_:1,__:[15]},8,["modelValue"]),a(C,{modelValue:o(_),"onUpdate:modelValue":t[6]||(t[6]=n=>F(_)?_.value=n:null),label:1},{default:s(()=>t[16]||(t[16]=[g(" 商品 ")])),_:1,__:[16]},8,["modelValue"]),o(_)===1&&o(i).spuId!==null?(x(),Y("div",Be,[a(l,{"body-style":{padding:"0px"},style:{height:"160px",width:"120px"}},{default:s(()=>[I("img",{src:o(T).mainImgUrl,style:{height:"104px",width:"100%"}},null,8,Me),I("div",ze,[I("span",Qe,J(o(T).name),1),a(d,{type:"primary",link:"",class:"card-prod-name-button",onClick:t[7]||(t[7]=n=>o(i).spuId=null)},{default:s(()=>t[17]||(t[17]=[g(" 删除 ")])),_:1,__:[17]})])]),_:1})])):w("",!0),o(_)===1&&o(i).spuId===null?(x(),Y("div",He,[a(d,{onClick:B},{default:s(()=>t[18]||(t[18]=[g(" 选择商品 ")])),_:1,__:[18]})])):w("",!0),o(P)?(x(),h(b,{key:2,ref_key:"prodSelectRef",ref:$,"is-single":!0,onRefreshSelectProds:L},null,512)):w("",!0)]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}},rt=Object.freeze(Object.defineProperty({__proto__:null,default:je},Symbol.toStringTag,{value:"Module"}));export{je as _,rt as a,dt as d,nt as p};

import{a as P,q as L,r as $,O as N,p as W,s as D,G as R}from"./element-plus@2.9.10_vue@3.5.14-e58ff881.js";import{g as q,u as x,s as U}from"./role-88be7d52.js";import{r as w,t as B}from"./index-6f2da097.js";import{$ as S}from"./_t-d5227884.js";import{q as H,D as O,b,y as p,a as z}from"./@vue_reactivity@3.5.14-2213b677.js";import{o as G,H as j,I as d,a as A,i as u,M as y,n as J}from"./@vue_runtime-core@3.5.14-81aa8ddd.js";import{U as g}from"./@vue_shared@3.5.14-94c2c668.js";import"./@vue-06e0889c.js";import"./lodash-es@4.17.21-e2bba480.js";import"./@vueuse_shared@9.13.0_vue@3.5.14-f0e16060.js";import"./@vueuse_core@9.13.0_vue@3.5.14-f98106e7.js";import"./@vue_runtime-dom@3.5.14-7e661aa4.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.14-71698097.js";import"./@sxzz_popperjs-es@2.11.7-7c8154ca.js";import"./@ctrl_tinycolor@3.6.1-86a38320.js";import"./dayjs@1.11.13-c188735a.js";import"./@intlify_core-base@9.2.2-93f07292.js";import"./@intlify_message-compiler@9.2.2-228be59b.js";import"./@intlify_shared@9.2.2-29bf9385.js";import"./source-map@0.6.1-02de534d.js";import"./@intlify_devtools-if@9.2.2-22850edc.js";import"./async-validator@4.2.5-774c2804.js";import"./memoize-one@6.0.0-297ddbcb.js";import"./normalize-wheel-es@1.2.0-ed76fb12.js";import"./@floating-ui_dom@1.7.0-586b25a4.js";import"./@floating-ui_core@1.7.0-7ff28a0e.js";import"./@floating-ui_utils@0.2.9-746d277c.js";import"./pinia@2.3.1_vue@3.5.14-4833dba6.js";import"./vue-demi@0.14.10_vue@3.5.14-71ba0ef2.js";import"./vue-router@4.5.1_vue@3.5.14-0f6ed4bc.js";import"./vue-i18n@9.2.2_vue@3.5.14-cf205787.js";import"./vue@3.5.14-dfc94670.js";import"./vue-cookies@1.8.3-f66fc855.js";import"./@element-plus_icons-vue@2.1.0_vue@3.5.14-0cb2d1d1.js";import"./axios@1.4.0-e76ab20a.js";import"./qs@6.11.2-13302ec8.js";import"./side-channel@1.1.0-f5737a48.js";import"./es-errors@1.3.0-c75f5a96.js";import"./object-inspect@1.13.4-95f40997.js";import"./crypto-js@4.1.1-4a4e7433.js";import"./side-channel-list@1.0.0-2bff8a80.js";import"./side-channel-map@1.0.1-ef12932d.js";import"./get-intrinsic@1.3.0-829e561c.js";import"./es-object-atoms@1.1.1-11ea1ab9.js";import"./math-intrinsics@1.1.0-9389030e.js";import"./gopd@1.2.0-f4eec54c.js";import"./es-define-property@1.0.1-88d30046.js";import"./has-symbols@1.1.0-1e41ff1e.js";import"./get-proto@1.0.1-a9f527cc.js";import"./dunder-proto@1.0.1-62f72dc7.js";import"./call-bind-apply-helpers@1.0.2-03b6ca7f.js";import"./function-bind@1.1.2-48f717dc.js";import"./hasown@2.0.2-f810df7c.js";import"./call-bound@1.0.4-15e4d619.js";import"./side-channel-weakmap@1.0.2-460ea971.js";import"./big.js@6.2.1-49ab783c.js";import"./dompurify@3.0.3-4985f3f0.js";import"./moment@2.29.4-4717c495.js";const Q={class:"dialog-footer"},ot={__name:"add-or-update",emits:["refreshDataList"],setup(X,{expose:k,emit:_}){const F=_,t=H({visible:!1,dataForm:{roleId:0,roleName:null,remark:null,createUserId:null,bizType:null,tenantId:null,menuIds:[],menuPermissionIds:[]},dataRule:{roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}]},selectedMenuWithPermissions:[],iniMenuWithPermissions:[],menuWithPermissions:[],menuListTreeProps:{value:"menuId",label:"title"},tempPermissionToMenuKey:5498415864,rules:{}}),{visible:I,dataForm:f,dataRule:v,menuWithPermissions:M,menuListTreeProps:T}=O(t),h=b(),c=b(),V=o=>{t.dataForm.roleId=o||0,t.visible=!0,J(()=>{h.value.resetFields(),c.value.setCheckedKeys([]),w().then(e=>{t.iniMenuWithPermissions=e,K(e)}),t.dataForm.roleId&&q(o).then(e=>{t.dataForm=e;const s=[];let i=[];const r=[],a=[];t.dataForm.menuPermissionIds.length&&t.dataForm.menuPermissionIds.forEach(n=>{n!==t.tempPermissionToMenuKey&&s.push(n+t.tempPermissionToMenuKey)}),t.dataForm.menuIds.length&&(t.dataForm.menuIds.forEach(n=>{const m=t.iniMenuWithPermissions;for(const l in m)if(m[l].menuId===n&&m[l].menuPermissions.length>0||m[l].parentId===n){a.push(n);break}r.push(n)}),i=C(a,r)),c.value.setCheckedKeys([].concat(s,i))})})},K=o=>{const e=[],s=[];for(const i in o){const r=o[i];if(e.push({menuId:r.menuId,parentId:r.parentId,title:r.title,type:0}),r.menuPermissions.length){const a=r.menuPermissions;for(const n in a){const m=a[n];e.push({menuId:m.menuPermissionId+t.tempPermissionToMenuKey,menuPermissionId:m.menuPermissionId,parentId:m.menuId,title:m.name,type:1}),s.push(m.menuId)}}}t.menuWithPermissions=B(e,"menuId")},C=(o,e)=>o.concat(e).filter(function(s,i,r){return r.indexOf(s)===r.lastIndexOf(s)}),E=()=>{h.value.validate(o=>{if(o){const e=[].concat(c.value.getCheckedKeys(),c.value.getHalfCheckedKeys()),s=[],i=[];if(e.length&&e.forEach(a=>{a<t.tempPermissionToMenuKey?s.push(a):i.push(a-t.tempPermissionToMenuKey)}),t.dataForm.menuIds=s,t.dataForm.menuPermissionIds=i,!s.length&&!i.length)return P.warning({message:"权限不能为空",duration:1500});(t.dataForm.roleId?x(t.dataForm):U(t.dataForm)).then(()=>{P({message:S("table.actionSuccess"),type:"success",duration:1500,onClose:()=>{t.visible=!1,F("refreshDataList"),h.value.resetFields()}})})}})};return k({init:V}),(o,e)=>{const s=L,i=$,r=N,a=W,n=D,m=R;return G(),j(m,{modelValue:p(I),"onUpdate:modelValue":e[4]||(e[4]=l=>z(I)?I.value=l:null),class:"component-role-add-or-update",title:p(f).roleId?o.$t("table.edit"):o.$t("table.create")},{footer:d(()=>[A("div",Q,[u(n,{onClick:e[2]||(e[2]=l=>I.value=!1)},{default:d(()=>[y(g(o.$t("table.cancel")),1)]),_:1}),u(n,{type:"primary",onClick:e[3]||(e[3]=l=>E())},{default:d(()=>[y(g(o.$t("table.confirm")),1)]),_:1})])]),default:d(()=>[u(a,{ref_key:"dataFormRef",ref:h,rules:p(v),model:p(f),"label-position":"right","label-width":"80px"},{default:d(()=>[u(i,{label:o.$t("rbac.role.roleName"),prop:"roleName"},{default:d(()=>[u(s,{modelValue:p(f).roleName,"onUpdate:modelValue":e[0]||(e[0]=l=>p(f).roleName=l)},null,8,["modelValue"])]),_:1},8,["label"]),u(i,{label:o.$t("rbac.role.remark"),prop:"remark"},{default:d(()=>[u(s,{modelValue:p(f).remark,"onUpdate:modelValue":e[1]||(e[1]=l=>p(f).remark=l)},null,8,["modelValue"])]),_:1},8,["label"]),u(i,{label:"授权"},{default:d(()=>[u(r,{ref_key:"menuListTreeRef",ref:c,data:p(M),props:p(T),"node-key":"menuId","show-checkbox":""},null,8,["data","props"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}};export{ot as default};
